<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>صفحه انتخاب واحد</title>
    <!-- Bootstrap CDN -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css"
    />
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Select2 CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }

      .container {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-top: 50px;
      }

      h1 {
        color: #007bff;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-check {
        margin-top: 10px;
      }

      .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
      }

      .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center">انتخاب واحد</h1>
      <form action="senddata" method="post">
        <div class="form-group">
          <label for="selectedCourses">انتخاب واحد</label>
          <select class="form-control" id="selectedCourses" multiple></select>
        </div>
        <div class="form-group">
          <label for="grade">نمره</label>
          <input
            type="number"
            class="form-control"
            id="grade"
            name="grade"
            min="0"
            max="20"
            step="0.01"
          />
        </div>
        <div class="input-group">
          <input
            type="number"
            class="form-control"
            id="grade"
            name="minUnit"
            min="0"
            max="24"
            value="12"
            placeholder="کمترین واحد"
            step="1"
          />
          <input
            type="number"
            class="form-control"
            id="grade"
            name="maxUnit"
            min="0"
            max="24"
            value="20"
            placeholder="بیشترین واحد"
            step="1"
          />
        </div>
        <div class="form-check">
          <div class="row justify-content-between">
            <label class="col-1"> پخش</label>
            <label class="col-1">فشرده</label>
          </div>
          <input
            type="range"
            class="form-range"
            id="distribution"
            min="0"
            max="100"
            value="0"
          />
        </div>

        <div class="form-check">
          <label class="form-check-label" for="dormitory"
            >خوابگاهی
            <input
              class="form-check-input"
              type="checkbox"
              id="dormitory"
              name="dormitory"
              value="خوابگاهی"
            />
          </label>
        </div>
        <div class="form-group text-center">
          <button type="" class="btn btn-primary" onclick="submitForm()">
            ثبت انتخاب
          </button>
        </div>
      </form>
    </div>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
      function submitForm() {
        // Get selected options from the multi-select dropdown
        const selectedCoursesElement =
          document.getElementById("selectedCourses");
        const selectedOptions = selectedCoursesElement.selectedOptions;

        // Extract values of selected options without using Array.from
        const selectedValues = [];
        for (let i = 0; i < selectedOptions.length; i++) {
          selectedValues.push(selectedOptions[i].value);
        }
        console.log(selectedValues);
        const grade = document.getElementById("grade").value;
        const minUnit = document.getElementsByName("minUnit")[0].value;
        const maxUnit = document.getElementsByName("maxUnit")[0].value;
        const distribution = document.getElementById("distribution").value;
        const dormitory = document.getElementById("dormitory").checked;

        // Create an object with the form data
        const formData = {
          selectedValues,
          grade,
          minUnit,
          maxUnit,
          distribution,
          dormitory,
        };

        // Send data to the server using fetch
        fetch("/senddata", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            // Handle success, e.g., show a success message to the user
          })
          .catch((error) => {
            console.error("Error:", error);
            // Handle errors, e.g., show an error message to the user
          });
      }

      fetch("/getData")
        .then((response) => response.json())
        .then((data) => {
          let list = [];

          data.forEach((course) => {
            if (notexist(list, course.Course_id_main)) {
              var option = $("<option>")
                .val(course.Course_id_main)
                .text(`${course.Course_name}`);
              list.push(course.Course_id_main);
              $("#selectedCourses").append(option);
            }
          });

          $("#selectedCourses").select2();
        });

      function notexist(list, k) {
        flag = true;
        list.forEach((course) => {
          if (course == k) {
            flag = false;
          }
        });
        return flag;
      }

      $(document).ready();
    </script>
  </body>
</html>
